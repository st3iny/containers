#!/bin/sh

# Configure MyJDownloader credentials.

secret=/etc/jdownloader/myjdownloader.env
#secret=./myjdownloader.env

config=/opt/jdownloader/cfg/org.jdownloader.api.myjdownloader.MyJDownloaderSettings.json
#config=./myjd.json

if [ ! -f "$secret" ]; then
    echo No MyJDownloader credentials found!
    echo Skipping provisioning ...
    exit 0;
fi

. "$secret"

mkdir -p "$(dirname "$config")"

if [ -f "$config" ]; then
    echo Patching MyJDownloader config
else
    echo Creating new MyJDownloader config
    echo '{}' > "$config"
fi

jq \
    '.email="'"$MYJDOWNLOADER_EMAIL"'" | .password="'"$MYJDOWNLOADER_PASSWORD"'"' \
    "$config" \
    | tee "$config".new \
    && mv "$config".new "$config"
